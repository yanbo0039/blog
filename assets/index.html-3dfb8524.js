import{_ as e,X as p,Y as o,a1 as t,Z as n,$ as s,a2 as c,a0 as l,F as k}from"./framework-68dd73a2.js";const r="/blog/assets/Oracle_53_1.png",i={},u={id:"_53-oracle-sql开发-——-子查询-md",tabindex:"-1"},d=n("a",{class:"header-anchor",href:"#_53-oracle-sql开发-——-子查询-md","aria-hidden":"true"},"#",-1),m={href:"http://xn--i8ss60ay71a.md",target:"_blank",rel:"noopener noreferrer"},v=l('<h4 id="概念" tabindex="-1"><a class="header-anchor" href="#概念" aria-hidden="true">#</a> 概念</h4><figure><img src="'+r+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><p>子查询使用指导</p><ul><li>子查询要用括号括起来</li><li>将子查询放在比较运算符的右边</li><li>对于单行子查询要使用单行运算符</li><li>对于多行子查询要使用多行运算符</li></ul></li><li><p>多行子查询</p><ul><li>子查询返回记录的条数 可以是一条或多条。</li><li>和多行子查询进行比较时，需要使用多行操作符，多行操作符包括： <ul><li>IN</li><li>ANY</li><li>ALL</li></ul></li><li>IN操作符和以前介绍的功能一致，判断是否与子查询 的任意一个返回值相同</li></ul></li><li><p>ROWNUM</p><ul><li>ROWNUM是一个伪列，伪列是使用上类似于表中的列，而 实际并没有存储在表中的特殊列；</li><li>ROWNUM的功能是在每次查询时，返回结果集的顺序号， 这个顺序号是在记录输出时才一步一步产生的，第一行 显示为1，第二行为2，以此类推。</li></ul></li><li><p>ROWNUM使用的注意点：</p><ul><li>1.如下SQL语句，SELECT * FROM EMP WHERE ROWNUM&gt;2;查询 不到任何记录，因为ROWNUM是在记录输出时才生成，且总是 从1开始，所以输出的第一条记录不满足&gt;2的条件，被过滤掉， 第二条的ROWNUM又成了1，又不满足〉2的条件，又被过滤掉， 依此类推，所以永远没有满足条件的记录，返回为空。所以 对于ROWNUM只能执行&lt;、&lt;=运算，不能执行&gt;、&gt;=或一个区间 运算Between..And等</li><li>2.ROWNUM和ORDER BY一起使用时，因为ROWNUM在记录输出时 生成，而ORDER BY子句在最后执行，所以当两者一起使用时， 需要注意ROWNUM实际是已经被排了序的ROWNUM。</li></ul></li><li><p>TOP-N查询</p><ul><li>Top-N查询主要是实现表中按照某个列排序，输出最大或 最小的N条记录功能。</li><li>Top-N分析语法：</li></ul></li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SELECT [列名], ROWNUM 
FROM (SELECT [列名] 
 FROM 表名
 ORDER BY Top-N操作的列 ASC|DESC)
WHERE ROWNUM &lt;= N;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>ASC:查询最小的N条记录</p></li><li><p>DESC：查询最大的N条记录</p></li><li><p>分页查询</p><ul><li>在Oracle中，利用ROWNUM的特性，可以实现数据库端的分 页查询，查询语法为： <ul><li>1.当未指定需要按照某列排序，语法为：</li></ul></li></ul></li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SELECT b.*
FROM (SELECT ROWNUM rn,[列名1,列名2,....列名n] 
 FROM 表名1,[表名2,...表名n] 
 WHERE [条件表达式 AND ] ROWNUM &lt;=目标页数*每页记录数) b
WHERE rn &gt; (目标页数-1)*每页记录数
或
SELECT b.*
FROM (SELECT ROWNUM rn,[列名1,列名2,....列名n] 
 FROM 表名1,[表名2,...表名n] 
 [WHERE 条件表达式]) b
WHERE rn &lt;=目标页数*每页记录数 and rn &gt; (目标页数-1)*每页记录数
思考：哪种方式效率高？
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>+ 2.当指定需要按照某列排序时，语法为：
</code></pre><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SELECT *
FROM (SELECT ROWNUM rn, b.*
 FROM (SELECT 列名1 [,列名2,....列名n] 
 FROM 表名1,[表名2,...表名n] 
 [WHERE 子句]
 ORDER BY 要排序的列 ASC|DESC ) b 
 WHERE ROWNUM &lt;=目标页数*每页记录数
 )
WHERE rn &gt; (目标页数-1)*每页记录数 ;
或：
SELECT *
FROM (SELECT ROWNUM rn, b.*
 FROM (SELECT 列名1 [,列名2,....列名n] 
 FROM 表名1,[表名2,...表名n] 
 [WHERE 子句]
 ORDER BY 要排序的列 ASC|DESC ) b
 )
WHERE rn &lt;=目标页数*每页记录数 and rn &gt; (目标页数-1)*每页记录数;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="示例代码" tabindex="-1"><a class="header-anchor" href="#示例代码" aria-hidden="true">#</a> 示例代码</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-----------------------------------------------</span>
<span class="token comment">-- 使用子查询</span>
<span class="token comment">--    ①  子查询（内部查询）优先执行</span>
<span class="token comment">--    ②  将步骤①中查询的结果交给父查询（外部查询）使用，用于确认或取消数据</span>
<span class="token comment">--</span>
<span class="token comment">--    单行子查询使用单行运算符：&gt;  &gt;=   =  &lt;  &lt;=  &lt;&gt;</span>
<span class="token comment">--    多行子查询使用多行运算符：in  any  all</span>
<span class="token comment">-----------------------------------------------</span>
<span class="token number">1.</span>查询出比JONES雇员工资高的其他雇员
<span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">=</span> <span class="token string">&#39;JONES&#39;</span><span class="token punctuation">;</span>                                <span class="token comment">--1. jones的工资是多少？  2975.00</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">=</span> <span class="token string">&#39;JONES&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--2.查询出比JONES雇员工资高的其他雇员</span>

<span class="token comment">-----------------------------------------------------------</span>
<span class="token comment">--单行子查询:返回一行一列       使用单行运算符：&gt;  &gt;=   =  &lt;  &lt;=  &lt;&gt;</span>
<span class="token comment">-----------------------------------------------------------</span>
<span class="token number">1.</span>显示和雇员<span class="token number">7369</span>从事相同工作并且工资大于雇员<span class="token number">7876</span>的雇员的姓名和工作。
<span class="token keyword">select</span> job <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">;</span>                <span class="token comment">--1.雇员7369从事的工作是什么  CLERK</span>
<span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7876</span><span class="token punctuation">;</span>                <span class="token comment">--2.雇员7876的工资是多少 1100.00</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span> job
  <span class="token keyword">from</span> emp
 <span class="token keyword">where</span> job <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> job <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">)</span>
   <span class="token operator">and</span> sal <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7876</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">--3.主查询</span>
   
<span class="token comment">--子查询中使用组函数</span>
<span class="token number">1.</span>查询工资最低的员工姓名，岗位及工资
<span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>                                <span class="token comment">--1. 查询最低工资是多少  800</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--2. 主查询</span>

<span class="token comment">--HAVING子句中使用子查询</span>
<span class="token number">1.</span>查询部门最低工资比<span class="token number">20</span>部门最低工资高的部门编号及最低工资
<span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>                           <span class="token comment">--1. 20部门最低工资  800</span>
<span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno <span class="token keyword">having</span> <span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">800</span><span class="token punctuation">;</span><span class="token comment">--2. 主查询</span>
   
<span class="token number">2.</span>查询哪个部门的员工人数高于各部门平均人数。
<span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span>                         <span class="token comment">--1. 各部门平均人数   3.5</span>
<span class="token keyword">select</span> deptno<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span>
  <span class="token keyword">from</span> emp
 <span class="token keyword">group</span> <span class="token keyword">by</span> deptno
<span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">--2. 主查询</span>
   
<span class="token comment">--练习</span>
<span class="token number">4.</span>查询部门人数大于所有部门平均人数的的部门编号，部门名称，部门人数
<span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span>                         <span class="token comment">--1.所有部门平均人数  3.5</span>

<span class="token keyword">select</span> e<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span> d<span class="token punctuation">.</span>dname<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span>
  <span class="token keyword">from</span> emp e<span class="token punctuation">,</span> dept d
 <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno
 <span class="token keyword">group</span> <span class="token keyword">by</span> e<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span> d<span class="token punctuation">.</span>dname
 <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">--2.主查询</span>
   
<span class="token comment">-----------------------------------------------------------</span>
<span class="token comment">--多行子查询:返回多行一列       使用多行运算符：in  any  all </span>
<span class="token comment">-----------------------------------------------------------</span>
<span class="token comment">--in </span>
<span class="token number">1.</span>查询员工工资为各个部门最低工资的员工信息
<span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span><span class="token comment">-- null 950  800 1300</span>

<span class="token keyword">select</span> empno<span class="token punctuation">,</span> ename
  <span class="token keyword">from</span> emp
 <span class="token keyword">where</span> sal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- not ok 单行子查询返回多个结果</span>
 
 <span class="token keyword">select</span> empno<span class="token punctuation">,</span> ename<span class="token punctuation">,</span>sal
  <span class="token keyword">from</span> emp
 <span class="token keyword">where</span> sal <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--ok</span>

<span class="token number">2.</span>查询是经理的员工姓名，工资
<span class="token keyword">select</span> <span class="token keyword">distinct</span> mgr <span class="token keyword">from</span> emp<span class="token punctuation">;</span>                                   <span class="token comment">--1.查询哪些人是经理？  7839,7782,7698,7902,7788,7566</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">in</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> mgr <span class="token keyword">from</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- 2.主查询</span>

<span class="token comment">--ANY 与任意值匹配    &lt;any    &gt;any    =any（相当于in）</span>
<span class="token comment">-- =any（相当于in）:与子查询的任意一个值相等</span>
<span class="token number">1.</span>查询是经理的员工姓名，工资。
<span class="token keyword">select</span> <span class="token keyword">distinct</span> mgr <span class="token keyword">from</span> emp<span class="token punctuation">;</span>                                   <span class="token comment">--1.查询哪些人是经理？  7839,7782,7698,7902,7788,7566</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span><span class="token keyword">any</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> mgr <span class="token keyword">from</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- 2.主查询</span>

<span class="token comment">-- &gt;any :大于最小值</span>
<span class="token number">2.</span>查询部门编号不为<span class="token number">10</span>，且工资比<span class="token number">10</span>部门【任意】一名员工工资【高】的员工编号，姓名，职位，工资。
<span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>                          <span class="token comment">--1.查询10部门所有员工的工资 2450.00,5000.00,1300.00</span>
<span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">&gt;</span><span class="token keyword">any</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">and</span> deptno <span class="token operator">&lt;&gt;</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">-- 2.主查询</span>

<span class="token comment">-- &lt;any :小于最大值</span>
<span class="token number">3.</span>查询部门编号不为<span class="token number">10</span>，且工资比<span class="token number">10</span>部门【任意】一名员工工资【低】的员工编号，姓名，职位，工资。
<span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>                         <span class="token comment">--1.查询10部门所有员工的工资 2450.00,5000.00,1300.00</span>
<span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">&lt;</span><span class="token keyword">any</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">and</span> deptno <span class="token operator">&lt;&gt;</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">-- 2.主查询</span>


<span class="token comment">--ALL 与所有值匹配    &lt;all    &gt;all    =all（无意义）</span>
<span class="token comment">-- =all :等于所有值</span>
<span class="token number">1.</span>【无意义】查询部门编号不为<span class="token number">10</span>，且工资与<span class="token number">10</span>部门【所有】员工工资【相等】的员工编号，姓名，职位，工资。
<span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>                          <span class="token comment">--1.查询10部门所有员工的工资 2450.00,5000.00,1300.00</span>
<span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">=</span><span class="token keyword">all</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">and</span> deptno <span class="token operator">&lt;&gt;</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">-- 2.主查询</span>

<span class="token comment">-- &gt;all :大于最大值</span>
<span class="token number">2.</span>查询部门编号不为<span class="token number">10</span>，且工资比<span class="token number">10</span>部门【所有】员工工资【高】的员工编号，姓名，职位，工资。
<span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>                          <span class="token comment">--1.查询10部门所有员工的工资 2450.00,5000.00,1300.00</span>
<span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">&gt;</span><span class="token keyword">all</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">and</span> deptno <span class="token operator">&lt;&gt;</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">-- 2.主查询</span>

<span class="token comment">-- &lt;all :小于最小值</span>
<span class="token number">3.</span>查询部门编号不为<span class="token number">10</span>，且工资比<span class="token number">10</span>部门【所有】员工工资【低】的员工编号，姓名，职位，工资。
<span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>                         <span class="token comment">--1.查询10部门所有员工的工资 2450.00,5000.00,1300.00</span>
<span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">&lt;</span><span class="token keyword">all</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">and</span> deptno <span class="token operator">&lt;&gt;</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">-- 2.主查询</span>


<span class="token comment">-----------------------------------------------------------</span>
<span class="token comment">--多列子查询:返回多行多列       通常用多行运算符：in</span>
<span class="token comment">-----------------------------------------------------------</span>
<span class="token comment">--成对比较</span>
<span class="token number">1.</span>查询出和<span class="token number">1981</span>年入职的【任意】一个员工的【部门和职位完全相同】员工姓名、部门、职位、入职日期<span class="token punctuation">,</span>不包括<span class="token number">1981</span>年入职员工
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> hiredate <span class="token operator">between</span> <span class="token string">&#39;1-1月-81&#39;</span> <span class="token operator">and</span> <span class="token string">&#39;31-12月-81&#39;</span><span class="token punctuation">;</span>  <span class="token comment">--1.1981年入职的员工的部门和职位</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> substr<span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;81&#39;</span><span class="token punctuation">;</span>                    <span class="token comment">--1.1981年入职的员工的部门和职位</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> to_char<span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span><span class="token string">&#39;yyyy&#39;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;1981&#39;</span><span class="token punctuation">;</span>             <span class="token comment">--1.1981年入职的员工的部门和职位</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> extract<span class="token punctuation">(</span><span class="token keyword">year</span> <span class="token keyword">from</span> hiredate<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;1981&#39;</span><span class="token punctuation">;</span>          <span class="token comment">--1.1981年入职的员工的部门和职位</span>

<span class="token keyword">select</span> <span class="token keyword">distinct</span> deptno<span class="token punctuation">,</span>job <span class="token keyword">from</span> emp <span class="token keyword">where</span> extract<span class="token punctuation">(</span><span class="token keyword">year</span> <span class="token keyword">from</span> hiredate<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;1981&#39;</span><span class="token punctuation">;</span>          <span class="token comment">--1.1981年入职的员工的部门和职位</span>

<span class="token keyword">select</span> <span class="token operator">*</span>
  <span class="token keyword">from</span> emp
 <span class="token keyword">where</span> <span class="token punctuation">(</span>deptno<span class="token punctuation">,</span> job<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">any</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> deptno<span class="token punctuation">,</span>job <span class="token keyword">from</span> emp <span class="token keyword">where</span> extract<span class="token punctuation">(</span><span class="token keyword">year</span> <span class="token keyword">from</span> hiredate<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;1981&#39;</span><span class="token punctuation">)</span>
   <span class="token operator">and</span> extract<span class="token punctuation">(</span><span class="token keyword">year</span> <span class="token keyword">from</span> hiredate<span class="token punctuation">)</span> <span class="token operator">&lt;&gt;</span> <span class="token string">&#39;1981&#39;</span><span class="token punctuation">;</span> <span class="token comment">--2.主查询</span>

<span class="token comment">--不成对比较</span>
<span class="token number">1.</span>查询出和<span class="token number">1981</span>年入职的【任意】一个员工的【部门或职位相同】员工姓名、部门、职位、入职日期<span class="token punctuation">,</span>不包括<span class="token number">1981</span>年入职员工。
<span class="token keyword">select</span> <span class="token keyword">distinct</span> deptno <span class="token keyword">from</span> emp <span class="token keyword">where</span> extract<span class="token punctuation">(</span><span class="token keyword">year</span> <span class="token keyword">from</span> hiredate<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;1981&#39;</span><span class="token punctuation">;</span>          <span class="token comment">--1.1981年入职的员工的部门</span>
<span class="token keyword">select</span> <span class="token keyword">distinct</span> job <span class="token keyword">from</span> emp <span class="token keyword">where</span> extract<span class="token punctuation">(</span><span class="token keyword">year</span> <span class="token keyword">from</span> hiredate<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;1981&#39;</span><span class="token punctuation">;</span>             <span class="token comment">--2.1981年入职的员工的职位</span>

<span class="token keyword">select</span> <span class="token operator">*</span>
  <span class="token keyword">from</span> emp
 <span class="token keyword">where</span> <span class="token punctuation">(</span>deptno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> deptno <span class="token keyword">from</span> emp <span class="token keyword">where</span> extract<span class="token punctuation">(</span><span class="token keyword">year</span> <span class="token keyword">from</span> hiredate<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;1981&#39;</span><span class="token punctuation">)</span>
    <span class="token operator">or</span> job <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> job <span class="token keyword">from</span> emp <span class="token keyword">where</span> extract<span class="token punctuation">(</span><span class="token keyword">year</span> <span class="token keyword">from</span> hiredate<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&#39;1981&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token operator">and</span> extract<span class="token punctuation">(</span><span class="token keyword">year</span> <span class="token keyword">from</span> hiredate<span class="token punctuation">)</span> <span class="token operator">&lt;&gt;</span> <span class="token string">&#39;1981&#39;</span><span class="token punctuation">;</span>

<span class="token comment">--子查询中的null值</span>
<span class="token number">1.</span>查询是经理的员工姓名，工资
<span class="token keyword">select</span> <span class="token keyword">distinct</span> mgr <span class="token keyword">from</span> emp<span class="token punctuation">;</span>                                   <span class="token comment">--1.查询哪些人是经理？  null,7839,7782,7698,7902,7788,7566</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">in</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> mgr <span class="token keyword">from</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 2.主查询</span>

<span class="token number">2.</span>查询不是经理的员工姓名
<span class="token keyword">select</span> <span class="token keyword">distinct</span> mgr <span class="token keyword">from</span> emp <span class="token keyword">where</span> mgr <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>             <span class="token comment">--1.查询哪些人是经理？  7839,7782,7698,7902,7788,7566</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">not</span> <span class="token operator">in</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> mgr <span class="token keyword">from</span> emp <span class="token keyword">where</span> mgr <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--2.主查询</span>

<span class="token comment">--在from子句中使用子查询</span>
<span class="token number">1.</span>查询比自己部门平均工资高的员工姓名，工资，部门编号，部门平均工资
<span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span><span class="token comment">--1.部门平均工资</span>
<span class="token keyword">select</span> e<span class="token punctuation">.</span>ename<span class="token punctuation">,</span>e<span class="token punctuation">.</span>sal<span class="token punctuation">,</span>e<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span>s<span class="token punctuation">.</span>avgsal <span class="token keyword">from</span> emp e<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> avgsal <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">)</span> s <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> s<span class="token punctuation">.</span>deptno <span class="token operator">and</span> e<span class="token punctuation">.</span>sal <span class="token operator">&gt;</span> s<span class="token punctuation">.</span>avgsal<span class="token punctuation">;</span>

<span class="token comment">--练习</span>
<span class="token number">1.</span>查询比自己职位平均工资高的员工姓名、职位，部门名称，职位平均工资
<span class="token keyword">select</span> job<span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> avgsal <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> job<span class="token punctuation">;</span><span class="token comment">--1.职位平均工资</span>

<span class="token keyword">select</span> e<span class="token punctuation">.</span>ename<span class="token punctuation">,</span>e<span class="token punctuation">.</span>job<span class="token punctuation">,</span>d<span class="token punctuation">.</span>dname<span class="token punctuation">,</span>s<span class="token punctuation">.</span>avgsal
  <span class="token keyword">from</span> emp e<span class="token punctuation">,</span> dept d<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> job<span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> avgsal <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> job<span class="token punctuation">)</span> s
 <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno
   <span class="token operator">and</span> e<span class="token punctuation">.</span>job <span class="token operator">=</span> s<span class="token punctuation">.</span>job
   <span class="token operator">and</span> e<span class="token punctuation">.</span>sal <span class="token operator">&gt;</span> s<span class="token punctuation">.</span>avgsal<span class="token punctuation">;</span>
   
<span class="token comment">--rownum:伪列,永远从1开始</span>
<span class="token comment">--     注意： rownum只能执行&lt;、&lt;=运算，不能执行&gt;、&gt;=或一个区间运算Between..And等</span>

<span class="token comment">--TOP-N查询</span>
<span class="token number">1.</span>查询工资最高的三个员工的信息
<span class="token keyword">select</span> rownum<span class="token punctuation">,</span>e1<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> emp<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">order</span> <span class="token keyword">by</span> sal <span class="token keyword">desc</span><span class="token punctuation">)</span> e1 <span class="token keyword">where</span> rownum <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token number">2.</span>查询工资最低的三个员工的信息
<span class="token keyword">select</span> rownum<span class="token punctuation">,</span>e1<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> emp<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">order</span> <span class="token keyword">by</span> sal<span class="token punctuation">)</span> e1 <span class="token keyword">where</span> rownum <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>


<span class="token comment">--数据库分页</span>
假设每页显示<span class="token number">5</span>条
<span class="token number">1</span>  <span class="token number">1</span><span class="token operator">-</span><span class="token number">5</span>
<span class="token number">2</span>  <span class="token number">6</span><span class="token operator">-</span><span class="token number">10</span>
<span class="token number">3</span>  <span class="token number">11</span><span class="token operator">-</span><span class="token number">15</span>
<span class="token number">4</span>  <span class="token number">16</span><span class="token operator">-</span><span class="token number">20</span>

开始下标：每页显示条数 <span class="token operator">*</span> 当前页码<span class="token operator">-</span><span class="token punctuation">(</span>每页显示条数<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span> 每页显示条数<span class="token operator">*</span>当前页码<span class="token operator">-</span>每页显示条数<span class="token operator">+</span><span class="token number">1</span><span class="token operator">=</span><span class="token punctuation">(</span>当前页码<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>每页显示条数 <span class="token operator">+</span> <span class="token number">1</span>
结束下标：每页显示条数 <span class="token operator">*</span> 当前页码

<span class="token number">1.</span>查询第一页数据
<span class="token keyword">select</span> rownum<span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> rownum <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token number">2.</span>查询第二页数据
<span class="token keyword">select</span> e1<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> rownum rn<span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> rownum <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> e1 <span class="token keyword">where</span> e1<span class="token punctuation">.</span>rn <span class="token operator">&gt;=</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">--效率高，仅查询10条</span>
<span class="token keyword">select</span> e1<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> rownum rn<span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp e<span class="token punctuation">)</span> e1 <span class="token keyword">where</span> e1<span class="token punctuation">.</span>rn <span class="token operator">&lt;=</span> <span class="token number">10</span> <span class="token operator">and</span> e1<span class="token punctuation">.</span>rn <span class="token operator">&gt;=</span> <span class="token number">6</span><span class="token punctuation">;</span>    <span class="token comment">--效率低，永远查询所有数据</span>

<span class="token number">3.</span>查询第三页数据
<span class="token keyword">select</span> e1<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> rownum rn<span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> rownum <span class="token operator">&lt;=</span> <span class="token number">15</span><span class="token punctuation">)</span> e1 <span class="token keyword">where</span> e1<span class="token punctuation">.</span>rn <span class="token operator">&gt;=</span> <span class="token number">11</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> e1<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> rownum rn<span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp e<span class="token punctuation">)</span> e1 <span class="token keyword">where</span> e1<span class="token punctuation">.</span>rn <span class="token operator">&lt;=</span> <span class="token number">15</span> <span class="token operator">and</span> e1<span class="token punctuation">.</span>rn <span class="token operator">&gt;=</span> <span class="token number">11</span><span class="token punctuation">;</span>

<span class="token comment">--公用的SQL分页查询语句</span>
<span class="token keyword">select</span> e1<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> rownum rn<span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> rownum <span class="token operator">&lt;=</span> <span class="token operator">&amp;</span><span class="token keyword">end</span><span class="token punctuation">)</span> e1 <span class="token keyword">where</span> e1<span class="token punctuation">.</span>rn <span class="token operator">&gt;=</span> <span class="token operator">&amp;</span><span class="token keyword">begin</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> e1<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> rownum rn<span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> rownum <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>每页显示条数 <span class="token operator">*</span> 当前页码<span class="token punctuation">)</span><span class="token punctuation">)</span> e1 <span class="token keyword">where</span> e1<span class="token punctuation">.</span>rn <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>当前页码<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>每页显示条数 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> e1<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> rownum rn<span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp e<span class="token punctuation">)</span> e1 <span class="token keyword">where</span> e1<span class="token punctuation">.</span>rn <span class="token operator">&lt;=</span><span class="token punctuation">(</span>每页显示条数 <span class="token operator">*</span> 当前页码<span class="token punctuation">)</span> <span class="token operator">and</span> e1<span class="token punctuation">.</span>rn <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>当前页码<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>每页显示条数 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--数据分页前，先排序</span>
<span class="token number">1.</span>根据入职日期降序排序后，再分页
<span class="token keyword">select</span> <span class="token operator">*</span>
  <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> rownum rn<span class="token punctuation">,</span> e1<span class="token punctuation">.</span><span class="token operator">*</span>
          <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> emp<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> hiredate <span class="token keyword">desc</span><span class="token punctuation">)</span> e1
         <span class="token keyword">where</span> rownum <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> e2
 <span class="token keyword">where</span> e2<span class="token punctuation">.</span>rn <span class="token operator">&gt;=</span> <span class="token number">6</span><span class="token punctuation">;</span>
 
<span class="token comment">--练习</span>
<span class="token number">1.</span>按照每页显示<span class="token number">5</span>条记录，分别查询工资最高的第<span class="token number">1</span>页，第<span class="token number">2</span>页，第<span class="token number">3</span>页信息，要求显示员工姓名、入职日期、部门名称、工资。
<span class="token keyword">select</span> <span class="token operator">*</span>
  <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> rownum rn<span class="token punctuation">,</span> e2<span class="token punctuation">.</span><span class="token operator">*</span>
          <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> sal <span class="token keyword">desc</span><span class="token punctuation">)</span> e2<span class="token punctuation">,</span>dept d
         <span class="token keyword">where</span> e2<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno <span class="token operator">and</span> rownum <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> e3
 <span class="token keyword">where</span> rn <span class="token operator">&gt;=</span> <span class="token number">6</span><span class="token punctuation">;</span>


<span class="token keyword">select</span> <span class="token operator">*</span>
  <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> rownum rn<span class="token punctuation">,</span> e2<span class="token punctuation">.</span><span class="token operator">*</span>
          <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> sal <span class="token keyword">desc</span><span class="token punctuation">)</span> e2
         <span class="token keyword">where</span> rownum <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> e3<span class="token punctuation">,</span>
       dept d
 <span class="token keyword">where</span> e3<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno
   <span class="token operator">and</span> rn <span class="token operator">&gt;=</span> <span class="token number">6</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span>
  <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> rownum rn<span class="token punctuation">,</span> e2<span class="token punctuation">.</span><span class="token operator">*</span>
          <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> e<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span>dname<span class="token punctuation">,</span>d<span class="token punctuation">.</span>loc
                  <span class="token keyword">from</span> emp e<span class="token punctuation">,</span> dept d
                 <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno
                 <span class="token keyword">order</span> <span class="token keyword">by</span> sal <span class="token keyword">desc</span><span class="token punctuation">)</span> e2
         <span class="token keyword">where</span> rownum <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> e3
 <span class="token keyword">where</span> rn <span class="token operator">&gt;=</span> <span class="token number">6</span><span class="token punctuation">;</span>


<span class="token comment">--练习</span>
<span class="token number">14.</span> 列出至少有一个雇员的所有部门
<span class="token comment">--分组语句</span>
<span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">--分组语句</span>

<span class="token comment">--嵌套子查询</span>
<span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span><span class="token comment">--1.查询部门人数</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span> ecount <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">)</span> d <span class="token keyword">where</span> d<span class="token punctuation">.</span>ecount <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">--2.主查询</span>

<span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span><span class="token comment">--1.查询部门人数</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept d<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>empno<span class="token punctuation">)</span> ecount <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">)</span> c <span class="token keyword">where</span> d<span class="token punctuation">.</span>deptno <span class="token operator">=</span> c<span class="token punctuation">.</span>deptno<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token operator">and</span> c<span class="token punctuation">.</span>ecount <span class="token operator">&gt;=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">--2.主查询</span>

<span class="token comment">--相关子查询</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept <span class="token keyword">where</span> <span class="token keyword">exists</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno<span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--1.相关子查询</span>

<span class="token number">24.</span> 显示每位经理管理员工的最低工资，及最低工资者的姓名
<span class="token keyword">select</span> mgr<span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> mgr<span class="token punctuation">;</span><span class="token comment">--1.每位经理管理员工的最低工资</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> mgr<span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> minsal <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> mgr<span class="token punctuation">)</span> s <span class="token keyword">where</span> e<span class="token punctuation">.</span>mgr <span class="token operator">=</span> s<span class="token punctuation">.</span>mgr <span class="token operator">and</span> e<span class="token punctuation">.</span>sal <span class="token operator">=</span> s<span class="token punctuation">.</span>minsal<span class="token punctuation">;</span><span class="token comment">--2.主查询</span>

<span class="token number">25.</span> 显示比工资最高的员工参加工作时间晚的员工姓名，参加工作时间
<span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>                                       <span class="token comment">--1.最高的工资   5000</span>
<span class="token keyword">select</span> hiredate <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--2.查工资最高的员工的参加工作的时间  1981/11/17</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> hiredate <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">select</span> hiredate <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--3.主查询</span>

<span class="token number">26.</span> 显示出平均工资最高的的部门平均工资及部门名称
<span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span> <span class="token comment">--1.部门平均工资</span>
<span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span> <span class="token comment">--1.部门的最高平均工资---补充  2916.66666666667</span>

<span class="token keyword">select</span> e<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span> d<span class="token punctuation">.</span>dname<span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>sal<span class="token punctuation">)</span> avgsal
  <span class="token keyword">from</span> emp e<span class="token punctuation">,</span> dept d
 <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno
 <span class="token keyword">group</span> <span class="token keyword">by</span> e<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span> d<span class="token punctuation">.</span>dname
<span class="token keyword">having</span> <span class="token function">avg</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>sal<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">--2.主查询</span>

<span class="token comment">--借助rownum实现</span>
<span class="token keyword">select</span> <span class="token operator">*</span>
  <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> e<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span> d<span class="token punctuation">.</span>dname<span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>sal<span class="token punctuation">)</span> avgsal
          <span class="token keyword">from</span> emp e<span class="token punctuation">,</span> dept d
         <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno
         <span class="token keyword">group</span> <span class="token keyword">by</span> e<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span> d<span class="token punctuation">.</span>dname
         <span class="token keyword">order</span> <span class="token keyword">by</span> avgsal <span class="token keyword">desc</span><span class="token punctuation">)</span> e
 <span class="token keyword">where</span> rownum <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>以上就是我关于 <em>Oracle-SQL开发 —— 子查询</em> 知识点的整理与总结的全部内容，希望对你有帮助。。。。。。。</strong></p><hr><h4 id="分割线" tabindex="-1"><a class="header-anchor" href="#分割线" aria-hidden="true">#</a> 分割线</h4><hr><h4 id="扩展知识" tabindex="-1"><a class="header-anchor" href="#扩展知识" aria-hidden="true">#</a> 扩展知识</h4><hr><p>分割线</p><hr><p><strong>博主为咯学编程：父母不同意学编程，现已断绝关系;恋人不同意学编程，现已分手;亲戚不同意学编程，现已断绝来往;老板不同意学编程,现已失业三十年。。。。。。如果此博文有帮到你欢迎打赏，金额不限。。。</strong></p>`,19);function w(y,b){const a=k("ExternalLinkIcon");return p(),o("div",null,[t(" more "),n("h1",u,[d,s(" 53-Oracle-SQL开发 —— "),n("a",m,[s("子查询.md"),c(a)])]),v])}const g=e(i,[["render",w],["__file","index.html.vue"]]);export{g as default};
