import{_ as e,X as p,Y as t,a1 as o,Z as n,$ as s,a2 as l,a0 as c,F as i}from"./framework-68dd73a2.js";const k={},u={id:"_57-oracle-sql开发-——-数据操作与事务控制-md",tabindex:"-1"},d=n("a",{class:"header-anchor",href:"#_57-oracle-sql开发-——-数据操作与事务控制-md","aria-hidden":"true"},"#",-1),r={href:"http://xn--jhqtlqvk5gjpk02fslah2f4yb.md",target:"_blank",rel:"noopener noreferrer"},m=c(`<div class="hint-container warning"><p class="hint-container-title">注意</p><p>本博文仅供学术研究和交流参考，严禁将其用于商业用途。如因违规使用产生的任何法律问题，使用者需自行负责。</p></div><h3 id="概念" tabindex="-1"><a class="header-anchor" href="#概念" aria-hidden="true">#</a> 概念</h3><ul><li><p>数据操作语言</p><ul><li>Data Manipulation Language ,简称DML，主要用来实现对数据库表中的数据进行操作。</li><li>数据操作语言主要包括如下几种： <ul><li>增加行数据：使用INSERT语句实现</li><li>修改行数据：使用UPDATE语句实现</li><li>删除行数据：使用DELETE语句实现</li><li>合并行数据：按照指定条件合并两个表的数据，使用MERGE语句实现</li></ul></li></ul></li><li><p>事务(Transaction)概念</p><ul><li>事务：也称工作单元，是由一个或多个SQL语句所组成的操作序列，这些SQL语句作为一个完整的工作单元，要么全部 执行成功，要么全部执行失败。在数据库中，通过事务来 保证数据的一致性。</li><li>事务处理语言：Transaction Process Language ,简称TPL， 主要用来对组成事务的DML语句的操作结果进行确认或取消。 确认也就是使DML操作生效，使用提交(COMMIT)命令实现； 取消也就是使DML操作失效，使用回滚(ROLLBACK)命令实现。</li><li>通过事务的使用，能防止数据库中出现数据不一致现象。 如两个银行账户进行转账，涉及到两条更新操作，这两条 更新操作只允许全部成功或失败，否则数据会出现不一致的现象。</li></ul></li><li><p>事务组成</p><ul><li>在数据库中，事务由一组相关的DML或SELECT语句，加上一 个TPL语句（COMMIT、ROLLBACK）或一个DDL语句(CREATE、 ALTER、DROP、TRUNCATE等)或一个DCL（GRANT、REVOKE） 语句。</li><li>例：如下语句组成两个事务。 <ul><li>INSERT….</li><li>UPDATE….</li><li>DELETE….</li><li>SELECT….</li><li>INSERT…</li><li>COMMIT;-- 前6条语句，组成第1个事务</li><li>UPDATE…</li><li>DELETE….</li><li>CREATE… ;--后3条语句，组成第2个事务</li></ul></li></ul></li><li><p>事务特征可用四个字母的缩写表示：即ACID</p><ul><li>原子性（Atomicity）</li></ul></li><li><p>事务就像“原子”一样，不可被分割，组成事务的DML操作语 句要么全成功，要么全失败，不可能出现部分成功部分失败 的情况。</p><ul><li>一致性（Consistency）</li><li>一旦事务完成，不管是成功的，还是失败的，整个系统处于 数据一致的状态。</li><li>隔离性（Isolation）</li></ul></li><li><p>一个事务的执行不会被另一个事务所干扰。比如两个人同时 从一个账户从取钱，通过事务的隔离性确保账户余额的正确 性。</p><ul><li>持久性（Durability）</li><li>也称为永久性，指事务一旦提交，对数据的改变就是永久的， 不可以再被回滚。</li></ul></li><li><p>显示结束</p><ul><li>提交(COMMIT)：使用COMMIT命令实现，以成功的方式结束事 务，组成事务的DML语句操作全部生效。</li><li>回滚(ROLLBACK)：使用ROLLBACK命令实现，以失败的方式结 束事务，组成事务的DML语句操作全部被取消。</li></ul></li><li><p>隐式结束</p><ul><li>隐式提交：当下列任意一种情况发生时，会发生隐式提交</li><li>执行一个DDL(CREATE、ALTER、DROP、TRUNCATE、RENAME） 语句；</li><li>执行一个DCL(GRANT、REVOKE)语句；</li><li>从SQL*Plus正常退出（即使用EXIT或QUIT命令退出）；</li></ul></li><li><p>隐式回滚：当下列任意一种情况发生时，会发生隐式回滚</p><ul><li>从SQL*Plus中强行退出</li><li>客户端连接到服务器端异常中断</li><li>系统崩溃</li></ul></li><li><p>事务开启</p><ul><li>事务自动开启于上一个事务结束后，执行的第一个DML语句。</li><li>例如：</li><li>…. <ul><li>COMMIT; --结束一个事务；</li><li>SELECT….</li><li>INSERT…. --开启一个事务</li><li>UPDATE….</li><li>DELETE….</li><li>SELECT….</li><li>INSERT…</li><li>COMMIT; --结束一个事务</li><li>UPDATE… --开启一个事务</li><li>DELETE….</li><li>ROLLBACK… ;--结束一个事务</li></ul></li></ul></li><li><p>设置保存点</p><ul><li>设置保存点：如果在一个事务内，想要回滚到指 定位置，不是回滚到事务的起始点，可以通过保 存点(SAVEPOINT)来实现。 <ul><li>SAVEPOINT savepointname；--定义一个保存点语句；</li><li>ROLLBACK TO savepointname;--回滚到指定保存点</li><li>注意：如上两条语句不结束事务的执行</li></ul></li></ul></li><li><p>锁的概念</p><ul><li>锁用来在多用户并发访问和操作数据库时,保证数据的一致 性的一种机制;</li><li>锁由Oracle自动管理，如一个DML操作，ORACLE默认的机制 是在DML操作影响的行记录上自动加锁;</li><li>锁在被相关的操作申请并持有后，会一直保持到事务的结 束，事务结束后，锁才会被释放;</li><li>查询语句不会锁定任何记录，如果在查询语句后面加FOR UPDATE子句会锁定查询所影响的行记录;</li></ul></li><li><p>提交或回滚前数据状态</p><ul><li>提交(COMMIT)或回滚(ROLLBACK)前的数据状态 <ul><li>数据变化前的状态可以被恢复;</li><li>当前会话可以使用SELECT语句来验证DML操作后的结果;</li><li>其它会话不能查看由当前用户的DML操作结果;</li><li>受影响记录被锁定，也就是其它用户不能改变受影响记录中 的数据;</li></ul></li></ul></li><li><p>提交后数据状态</p><ul><li>提交(COMMIT) 后的数据状态 <ul><li>在数据库中数据变化成为永久性的，先前的数据状态永久性 的消失；</li><li>所有用户/会话都可以查询到提交COMMIT后的结果；</li><li>锁定的记录被释放，可以有效地被其他用户操作；</li><li>所有的存储节点被清除；</li></ul></li></ul></li><li><p>回滚(ROLLBACK)后的数据状态</p><ul><li>先前的数据状态被恢复;</li><li>锁定的记录被释放;</li><li>所有的存储节点被清除;</li></ul></li></ul><h3 id="示例代码" tabindex="-1"><a class="header-anchor" href="#示例代码" aria-hidden="true">#</a> 示例代码</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>数据查询语言 DQL<span class="token punctuation">(</span><span class="token keyword">Data</span> Query <span class="token keyword">Language</span><span class="token punctuation">)</span>: <span class="token keyword">select</span>
数据操作语言 DML<span class="token punctuation">(</span><span class="token keyword">Data</span> Manipulation <span class="token keyword">Language</span><span class="token punctuation">)</span>: <span class="token keyword">insert</span>   <span class="token keyword">update</span>   <span class="token keyword">delete</span>
事务处理语言 TPL<span class="token punctuation">(</span><span class="token keyword">Transaction</span> Process <span class="token keyword">Language</span><span class="token punctuation">)</span>:<span class="token keyword">commit</span>  <span class="token keyword">rollback</span>

<span class="token comment">--------------------------------------------------------------------------------------------------</span>
<span class="token comment">-- 新增数据(插入数据)</span>
<span class="token comment">--              语法： insert into 表名(列1，列2....) values(值1，值2....);  一次新增一行</span>
<span class="token comment">--                     insert into 表名(列1，列2....) 子查询;   一次新增N行</span>
<span class="token comment">--</span>
<span class="token comment">--              1.列名列表与值列表的个数、类型必须保持一致</span>
<span class="token comment">--              2.列名列表可以省略，默认值列表给所有列赋值</span>
<span class="token comment">--              3.值列表中日期、字符串必须使用&#39;&#39;单引号括起来</span>
<span class="token comment">--------------------------------------------------------------------------------------------------</span>
<span class="token comment">--插入空值NULL   隐含法: 在列名列表中忽略该列。</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token string">&#39;开发部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--插入空值NULL  显示法: 指定 NULL关键字或者&#39;&#39;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">,</span>loc<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token string">&#39;需求部&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;东软大厦125C&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--全部给值</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">,</span>loc<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token string">&#39;测试部&#39;</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--loc给空值</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token string">&#39;实施部&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">--2.列名列表可以省略，默认值列表给所有列赋值</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token string">&#39;运维部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">--not OK 没有足够的值</span>

<span class="token comment">--插入日期值  SYSDATE 函数记录当前日期和时间</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> emp<span class="token punctuation">(</span>empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">7777</span><span class="token punctuation">,</span><span class="token string">&#39;李四&#39;</span><span class="token punctuation">,</span>sysdate<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--插入日期值   可以使用RR日期格式，也可以使用to_date()函数转换YY日期格式</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> emp<span class="token punctuation">(</span>empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span><span class="token string">&#39;李二&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;2019-08-01&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--文字与格式字符串不匹配</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> emp<span class="token punctuation">(</span>empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span><span class="token string">&#39;李二&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1-8月-19&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">--RR日期格式</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> emp<span class="token punctuation">(</span>empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span><span class="token string">&#39;李二&#39;</span><span class="token punctuation">,</span>to_date<span class="token punctuation">(</span><span class="token string">&#39;2019-08-01&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;yyyy-mm-dd&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--YY日期格式</span>

<span class="token comment">--插入特殊字符</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token string">&#39;~!@#$%^*()-+&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--ok</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token string">&#39;&amp;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">--ok   </span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token string">&#39;&amp;需求部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- not OK    &amp;修饰的字符表示一个变量，等待用户输入变量值</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token string">&#39;\\&amp;需求部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--not ok</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token string">&#39;&amp;&#39;</span> <span class="token operator">||</span> <span class="token string">&#39;需求部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">--ok</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span>chr<span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;需求部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">--ok</span>

<span class="token comment">--ascii() 查看指定字符的ascii编码</span>
<span class="token keyword">select</span> ascii<span class="token punctuation">(</span><span class="token string">&#39;&amp;&#39;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span> <span class="token comment">--38</span>

<span class="token comment">--chr() 查看指定ascii编码代表的字符</span>
<span class="token keyword">select</span> chr<span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>

<span class="token comment">----------------------</span>
<span class="token comment">--批量新增（备份数据）</span>
<span class="token comment">----------------------</span>
<span class="token number">1.</span> 将部门<span class="token number">10</span>所有的员工信息备份到emp_dept10表中
①复制表结构：创建表emp_dept10，且结构与emp表一致
<span class="token keyword">create</span> <span class="token keyword">table</span> emp_dept10 <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>           <span class="token comment">--1.复制emp表的表结构与所有数据    </span>
<span class="token keyword">create</span> <span class="token keyword">table</span> emp_dept10 <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">--1.仅复制emp表的表结构</span>

② 使用子查询批量新增数据：将部门<span class="token number">10</span>的员工数据备份到emp_dept10表中
<span class="token keyword">insert</span> <span class="token keyword">into</span> emp_dept10 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">--2.复制所有列数据   </span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> emp_dept10<span class="token punctuation">(</span>empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span> <span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>hiredate <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">--2.复制指定列数据</span>

<span class="token comment">--------------------------------------------------------------------------------------------------</span>
<span class="token comment">-- 修改数据</span>
<span class="token comment">--              语法： update 表名 set 列名1=值1[,列名2=值2.....]  [where 限制条件]</span>
<span class="token comment">--------------------------------------------------------------------------------------------------</span>
<span class="token comment">--使用 WHERE 子句指定要修改的记录</span>
<span class="token number">1.</span>把员工编号为<span class="token number">7782</span>的部门编号修改为<span class="token number">20</span>
<span class="token keyword">update</span> emp <span class="token keyword">set</span> deptno <span class="token operator">=</span> <span class="token number">20</span> <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7782</span><span class="token punctuation">;</span>

<span class="token comment">--如果要修改所有记录，WHERE子句可以忽略</span>
<span class="token number">2.</span>把所有员工的部门编号修改为<span class="token number">20</span>
<span class="token keyword">update</span> emp <span class="token keyword">set</span> deptno <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

<span class="token comment">--一次修改多列</span>
<span class="token number">3.</span>把部门编号为<span class="token number">10</span>的员工，部门编号调整为<span class="token number">20</span>，工资增加<span class="token number">100</span>
<span class="token keyword">update</span> emp <span class="token keyword">set</span> deptno <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>sal <span class="token operator">=</span> sal<span class="token operator">+</span><span class="token number">100</span> <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">--嵌入子查询修改</span>
<span class="token number">4.</span>把部门编号为<span class="token number">10</span>的员工，部门编号调整为<span class="token number">20</span>，工资在原有的基础上，增加所有人的平均工资
<span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span><span class="token comment">--1.所有人的平均工资  2073.5</span>
<span class="token keyword">update</span> emp <span class="token keyword">set</span> deptno<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>sal<span class="token operator">=</span> sal<span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">)</span> <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">--修改记录时的完整性约束错误</span>
<span class="token number">5.</span>把部门编号为<span class="token number">10</span>的员工，部门编号调整为<span class="token number">55</span>
<span class="token keyword">update</span> emp <span class="token keyword">set</span> deptno<span class="token operator">=</span><span class="token number">55</span> <span class="token keyword">where</span> deptno <span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">--not ok 未找到父项关键字  emp.deptno 的数据来源于 dept.deptno,此时dept中没有55编号的部门存在</span>

<span class="token comment">--相关子查询修改</span>
<span class="token number">1.</span>在emp中新增dname列
<span class="token keyword">alter</span> <span class="token keyword">table</span> emp <span class="token keyword">add</span><span class="token punctuation">(</span>dname varchar2<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token number">2.</span>将emp表中的dname更新为实际部门的名称
<span class="token keyword">update</span> emp <span class="token keyword">set</span> dname <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> dname <span class="token keyword">from</span> dept <span class="token keyword">where</span> deptno <span class="token operator">=</span> emp<span class="token punctuation">.</span>deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--练习</span>
<span class="token number">2.</span>修改奖金为<span class="token boolean">null</span>的员工，奖金设置为<span class="token number">0</span>
<span class="token keyword">update</span> emp <span class="token keyword">set</span> comm <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">where</span> comm <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> comm <span class="token operator">=</span> <span class="token boolean">null</span><span class="token punctuation">;</span><span class="token comment">--null与任意值计算均为null</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> comm <span class="token operator">in</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--null与任意值计算均为null</span>

<span class="token comment">--------------------------------------------------------------------------------------------------</span>
<span class="token comment">-- 删除数据</span>
<span class="token comment">--              语法： delete [from] 表名  [where 限制条件]</span>
<span class="token comment">--------------------------------------------------------------------------------------------------</span>
<span class="token comment">--删除选中记录</span>
<span class="token number">1.</span>删除职位是CLERK的员工记录
<span class="token keyword">delete</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> job <span class="token operator">=</span> <span class="token string">&#39;CLERK&#39;</span><span class="token punctuation">;</span>

<span class="token comment">--删除全部记录</span>
<span class="token number">2.</span>删除所有员工记录
<span class="token keyword">delete</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token keyword">delete</span> emp<span class="token punctuation">;</span>

<span class="token comment">--基于另一个表删除本表记录</span>
<span class="token number">3.</span>删除部门SALES的员工
<span class="token keyword">select</span> deptno <span class="token keyword">from</span> dept <span class="token keyword">where</span> dname <span class="token operator">=</span> <span class="token string">&#39;SALES&#39;</span><span class="token punctuation">;</span><span class="token comment">--1.SALES的部门编号为多少？  30</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> deptno <span class="token keyword">from</span> dept <span class="token keyword">where</span> dname <span class="token operator">=</span> <span class="token string">&#39;SALES&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--删除记录时的完整性约束错误</span>
<span class="token number">4.</span>删除部门编号为<span class="token number">10</span>的部门记录
<span class="token keyword">delete</span> <span class="token keyword">from</span> dept <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">--not ok 已找到子记录  因为emp.deptno引用dept.deptno,而dept.deptno为10的部门已经存在3个员工</span>

<span class="token comment">--相关DELETE</span>
<span class="token number">5.</span>删除曾经做过入职的员工记录
<span class="token keyword">delete</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> 曾经做过入职<span class="token punctuation">;</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> <span class="token keyword">exists</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp_jobhistory <span class="token keyword">where</span> empno <span class="token operator">=</span> emp<span class="token punctuation">.</span>empno<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token number">6.</span>删除没有员工的部门记录
<span class="token keyword">delete</span> <span class="token keyword">from</span> dept <span class="token keyword">where</span> 没有员工的部门<span class="token punctuation">;</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> dept <span class="token keyword">where</span> <span class="token operator">not</span> <span class="token keyword">exists</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--------------------------------------------------------------------------------------------------</span>
<span class="token comment">-- 事务管理: 由一组SQL语句组成的管理单元,要么全部执行成功，要么全部执行失败</span>
<span class="token comment">--              </span>
<span class="token comment">--       事务四大特性：</span>
<span class="token comment">--             1. 原子性：一个事务中所有的SQL语句，执行时，要么全部执行成功，要么全部执行失败</span>
<span class="token comment">--             2. 一致性：不论SQL语句执行成功，还是失败，整个数据处于平衡状态。</span>
<span class="token comment">--             3. 隔离性：事务与事务之间相互隔离，互不影响</span>
<span class="token comment">--             4. 持久性：一旦数据被提交，永久性被保存到数据库中，不能再撤回</span>
<span class="token comment">--</span>
<span class="token comment">--       事务开启：上一个事务结束以后，执行下一个DML(增、删、改)语句即开始新的事务</span>
<span class="token comment">--</span>
<span class="token comment">--       事务结束：</span>
<span class="token comment">--                1.显示结束</span>
<span class="token comment">--                       commit:显示提交</span>
<span class="token comment">--                       rollback:显示回滚（撤销所有的操作）</span>
<span class="token comment">--</span>
<span class="token comment">--                2.隐式结束</span>
<span class="token comment">--                      隐式提交：当下列任意一种情况发生时，会发生隐式提交</span>
<span class="token comment">--                              1.执行一个DDL(CREATE、ALTER、DROP、TRUNCATE、RENAME）语句；</span>
<span class="token comment">--                              2.执行一个DCL(GRANT、REVOKE)语句；</span>
<span class="token comment">--                              3.从SQL*Plus正常退出（即使用EXIT或QUIT命令退出）；</span>
<span class="token comment">--</span>
<span class="token comment">--                      隐式回滚：当下列任意一种情况发生时，会发生隐式回滚</span>
<span class="token comment">--                              1. 从SQL*Plus中强行退出</span>
<span class="token comment">--                              2. 客户端连接到服务器端异常中断</span>
<span class="token comment">--                              3. 系统崩溃</span>

<span class="token comment">--------------------------------------------------------------------------------------------------</span>
<span class="token comment">--开启事务</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token string">&#39;财务部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token string">&#39;人力资源部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">rollback</span><span class="token punctuation">;</span><span class="token comment">--显示回滚,事务结束</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token string">&#39;后勤部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span><span class="token comment">--显示提交，事务结束</span>

<span class="token comment">------------------------------------------------------</span>
<span class="token comment">--设置保存点</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">81</span><span class="token punctuation">,</span><span class="token string">&#39;需求部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">savepoint</span> poin1<span class="token punctuation">;</span><span class="token comment">--设置保存点1</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">82</span><span class="token punctuation">,</span><span class="token string">&#39;UI部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">83</span><span class="token punctuation">,</span><span class="token string">&#39;前端部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">savepoint</span> poin2<span class="token punctuation">;</span><span class="token comment">--设置保存点2</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">,</span><span class="token string">&#39;开发部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">85</span><span class="token punctuation">,</span><span class="token string">&#39;测试部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">savepoint</span> poin3<span class="token punctuation">;</span><span class="token comment">--设置保存点3</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">86</span><span class="token punctuation">,</span><span class="token string">&#39;实施部&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">rollback</span> <span class="token keyword">to</span> poin2<span class="token punctuation">;</span><span class="token comment">--回滚保存点2的位置</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span> <span class="token comment">--提交部分事务SQL语句</span>

<span class="token keyword">rollback</span><span class="token punctuation">;</span><span class="token comment">--事务已经被提交，不可能再被回滚</span>
<span class="token comment">------------------------------------------------------</span>

<span class="token comment">------------------------------------------------------</span>
<span class="token comment">-- 锁：</span>
<span class="token comment">--      </span>
<span class="token comment">--      行级锁  和  表级锁             （悲观锁 和  乐观锁）</span>
<span class="token comment">--</span>
<span class="token comment">--      行级锁: ORACLE默认的机制是在DML操作影响的行记录上自动加锁</span>
<span class="token comment">--              当会话1在修改指定行数据，且没有commit提交事务或者rollback回滚事务之前,</span>
<span class="token comment">--              该数据行被锁定，其他会话2不允许修改该数据。</span>
<span class="token comment">--              如果会话1结束事务，锁释放，其他会话2可以继续操作该数据</span>
<span class="token comment">--</span>
<span class="token comment">--      表级锁：当会话1在操作指定数据时，表将被锁定，其他会话不允许对表结构进行修改（新增列、修改列、删除列）</span>
<span class="token comment">------------------------------------------------------</span>
<span class="token comment">--会话1 （执行一个事务）</span>
<span class="token keyword">update</span> dept <span class="token keyword">set</span> loc<span class="token operator">=</span><span class="token string">&#39;125C教室&#39;</span> <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">83</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept<span class="token punctuation">;</span>

<span class="token comment">--会话2（执行一个事务）</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> dept <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="分割线" tabindex="-1"><a class="header-anchor" href="#分割线" aria-hidden="true">#</a> 分割线</h3><hr><div class="hint-container info"><p class="hint-container-title">相关信息</p><p><strong>以上就是我关于 <em>Oracle-SQL开发 —— 数据操作与事务控制</em> 知识点的整理与总结的全部内容，希望对你有帮助。。。。。。。</strong></p></div>`,9);function v(b,w){const a=i("ExternalLinkIcon");return p(),t("div",null,[o(" more "),n("h1",u,[d,s(" 57-Oracle-SQL开发 —— "),n("a",r,[s("数据操作与事务控制.md"),l(a)])]),m])}const L=e(k,[["render",v],["__file","oracle57.html.vue"]]);export{L as default};
